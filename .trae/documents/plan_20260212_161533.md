# 修复Supabase变量重复声明问题的最终方案

## 问题分析

错误信息 `Uncaught SyntaxError: Identifier 'supabase' has already been declared` 表明 `supabase` 变量仍然被重复声明。

### 根本原因
1. **Supabase客户端库冲突**：引入的Supabase客户端库在全局作用域中已经声明了 `supabase` 变量
2. **变量名冲突**：我们的代码尝试再次声明同名变量
3. **作用域污染**：全局作用域中的变量与我们的局部变量冲突

## 解决方案

### 1. 使用不同的变量名

将 `supabase` 变量重命名为 `sb` 或其他不冲突的名称：

```javascript
// Supabase配置
const supabaseUrl = 'https://nxvcwyufmbpciccgjief.supabase.co';
const supabaseKey = 'sb_publishable_AeEezx7Vi-S_eh7l4Vqh2w_dfhr-Ovh';

// 使用不同的变量名避免冲突
let sb;
try {
    // 尝试使用默认方法
    sb = createClient(supabaseUrl, supabaseKey);
} catch (e) {
    // 如果失败，尝试使用全局supabase对象
    sb = window.createClient ? window.createClient(supabaseUrl, supabaseKey) : null;
    if (!sb) {
        console.error('无法初始化Supabase客户端');
        alert('无法连接到服务器，请稍后再试');
    }
}
```

### 2. 更新所有使用supabase的地方

将代码中所有使用 `supabase` 的地方改为使用新的变量名 `sb`：

- 登录/注册函数
- 游戏大厅逻辑
- 实时同步功能
- 游戏状态保存

### 3. 清理全局作用域

确保代码不会污染全局作用域，使用立即执行函数表达式(IIFE)包装代码：

```javascript;(function() {
    // 所有代码放在这里
})();
```

### 4. 检查其他可能的冲突

- 确保没有其他地方重复声明变量
- 检查函数作用域和块作用域
- 验证变量初始化顺序

## 预期结果

- 消除 `Uncaught SyntaxError: Identifier 'supabase' has already been declared` 错误
- 成功初始化Supabase客户端
- 登录/注册功能正常工作
- 游戏大厅和联机对战功能可用
- 移动端适配良好

此修复将确保曜弈棋联机版能够正常运行，用户可以通过邀请机制与好友进行对战。