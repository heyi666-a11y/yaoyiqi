# 修复Supabase客户端初始化问题

## 问题分析

根据错误信息 `无法初始化Supabase客户端`，问题出在Supabase客户端的初始化过程中。

### 可能的原因

1. **Supabase客户端库未正确加载**：引入的Supabase客户端库可能没有正确加载，导致`createClient`函数不存在
2. **URL或密钥错误**：提供的Supabase URL或密钥可能不正确
3. **网络连接问题**：可能是网络连接问题导致无法连接到Supabase服务器
4. **权限问题**：密钥权限不足，无法访问Supabase API

## 解决方案

### 1. 确保Supabase客户端库正确加载

检查HTML头部的Supabase客户端库引入是否正确：

```html
<!-- Supabase Client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
```

### 2. 修正客户端初始化代码

使用正确的初始化方式：

```javascript
// Supabase配置
const supabaseUrl = 'https://nxvcwyufmbpciccgjief.supabase.co';
const supabaseKey = 'sb_publishable_AeEezx7Vi-S_eh7l4Vqh2w_dfhr-Ovh';

// 正确初始化Supabase客户端
let sb;
try {
    // 尝试使用全局supabase对象
    if (typeof supabase !== 'undefined') {
        sb = supabase.createClient(supabaseUrl, supabaseKey);
        console.log('Supabase客户端初始化成功');
    } else {
        throw new Error('Supabase对象未定义');
    }
} catch (e) {
    console.error('Supabase初始化错误:', e);
    alert('无法连接到服务器，请检查网络连接或稍后再试');
    sb = null;
}
```

### 3. 添加调试信息

添加详细的调试信息，帮助诊断问题：

```javascript
// 检查Supabase库是否加载
console.log('Supabase库状态:', typeof supabase);
console.log('是否存在createClient方法:', typeof supabase.createClient);

// 初始化后检查
console.log('Supabase客户端:', sb);
console.log('客户端是否有效:', sb && typeof sb.from === 'function');
```

### 4. 提供备用方案

如果Supabase客户端初始化失败，提供本地模拟模式：

```javascript
// 游戏模式：online或offline
let gameMode = 'online';

if (!sb) {
    console.warn('切换到离线模式');
    gameMode = 'offline';
    alert('无法连接到服务器，切换到离线模式');
    // 初始化离线模式状态
}
```

### 5. 验证Supabase配置

确保提供的Supabase URL和密钥正确无误：

* **URL**：`https://nxvcwyufmbpciccgjief.supabase.co`

* **密钥**：`sb_publishable_AeEezx7Vi-S_eh7l4Vqh2w_dfhr-Ovh`

## 预期结果

* Supabase客户端成功初始化

* 登录/注册功能正常工作

* 游戏大厅和联机对战功能可用

* 提供清晰的错误信息和备用方案

此修复将确保曜弈棋联机版能够正常连接到Supabase服务器，实现完整的联机对战功能。
