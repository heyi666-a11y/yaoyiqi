# 修复Supabase客户端初始化问题

## 问题分析

根据错误信息 `无法初始化Supabase客户端`，问题出在Supabase客户端的初始化过程中。

### 根本原因
1. **客户端库加载问题**：当前代码尝试使用 `createClient` 函数，但该函数可能不存在
2. **初始化方式错误**：没有正确使用全局 `supabase` 对象
3. **密钥权限**：提供的密钥可能权限不足
4. **网络连接**：可能存在网络连接问题

## 解决方案

### 1. 修正客户端初始化代码

使用正确的初始化方式，确保使用全局 `supabase` 对象：

```javascript
// Supabase配置
const supabaseUrl = 'https://nxvcwyufmbpciccgjief.supabase.co';
const supabaseKey = 'sb_publishable_AeEezx7Vi-S_eh7l4Vqh2w_dfhr-Ovh';

// 正确初始化Supabase客户端
let sb;
try {
    // 检查全局supabase对象是否存在
    if (typeof supabase !== 'undefined') {
        sb = supabase.createClient(supabaseUrl, supabaseKey);
        console.log('Supabase客户端初始化成功');
    } else {
        throw new Error('Supabase库未加载');
    }
} catch (error) {
    console.error('Supabase初始化错误:', error);
    alert('无法连接到服务器，请检查网络连接或稍后再试');
    sb = null;
}
```

### 2. 添加详细的调试信息

添加调试信息，帮助诊断问题：

```javascript
// 检查Supabase库加载状态
console.log('Supabase库状态:', typeof supabase);
console.log('是否存在createClient方法:', typeof supabase?.createClient);

// 初始化后检查
console.log('Supabase客户端:', sb);
console.log('客户端是否有效:', sb && typeof sb.from === 'function');
```

### 3. 验证Supabase配置

确保提供的配置正确：
- **URL**：`https://nxvcwyufmbpciccgjief.supabase.co`
- **密钥**：`sb_publishable_AeEezx7Vi-S_eh7l4Vqh2w_dfhr-Ovh`

### 4. 检查数据库表结构

确保已在Supabase中创建了必要的表结构：
- `users`：用户表
- `games`：游戏表
- `game_states`：游戏状态表

### 5. 添加错误处理

为所有Supabase操作添加错误处理，确保即使出现问题也能提供友好的错误信息：

```javascript
async function login(username, password) {
    if (!sb) {
        alert('无法连接到服务器，请检查网络连接');
        return false;
    }
    
    try {
        const { data, error } = await sb
            .from('users')
            .select('*')
            .eq('username', username)
            .eq('password_hash', password)
            .single();
        
        if (error) {
            console.error('登录错误:', error);
            alert('登录失败: ' + (error.message || '请检查用户名和密码'));
            return false;
        }
        
        currentUser = data;
        showLobby();
        return true;
    } catch (error) {
        console.error('登录异常:', error);
        alert('登录失败，请稍后再试');
        return false;
    }
}
```

## 预期结果

- Supabase客户端成功初始化
- 登录/注册功能正常工作
- 游戏大厅和联机对战功能可用
- 提供清晰的错误信息
- 支持实时同步游戏状态

此修复将确保曜弈棋联机版能够正常连接到Supabase服务器，实现完整的联机对战功能。