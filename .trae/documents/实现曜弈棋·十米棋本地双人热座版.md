# 实现计划

## 1. HTML结构设计
- 创建单文件index.html
- 布局：标题 + 状态栏（当前玩家、剩余棋子数） + Canvas棋盘 + 控制按钮（新开局、投降）

## 2. CSS样式设计
- 浅色背景，深灰网格
- 响应式布局，Canvas自适应
- 清晰的棋子样式（红方#c44，蓝方#4488cc）
- 无动画，零特效

## 3. 数据结构设计
```javascript
const boardState = {
  turn: 'red', // 先手红方
  red: {
    star: { x: 5, y: 10 },
    satellites: [/* 包含pos和face属性的卫星数组 */]
  },
  blue: {
    star: { x: 5, y: 0 },
    satellites: [/* 包含pos和face属性的卫星数组 */]
  },
  winner: null
};
```

## 4. 核心功能实现

### 4.1 初始化与绘制
- `initBoard()`: 初始化棋盘状态，设置初始布局
- `drawBoard()`: 绘制棋盘网格、棋子（将星、卫星）、高亮选中状态

### 4.2 交互处理
- `handleCanvasClick()`: 处理点击事件，转换鼠标坐标为棋盘坐标
- 双击检测实现翻面功能

### 4.3 规则验证
- `isValidMove(satellite, target)`: 验证卫星移动合法性
- `isValidSwap(star, satellite)`: 验证将星换位合法性
- `isValidCannon(source, target)`: 验证炮击合法性
- `isValidDuel(sourceStar, targetStar)`: 验证将星对决合法性
- `isPathClear(start, end)`: 检查路径是否无阻挡

### 4.4 游戏逻辑
- `applyMove(move)`: 执行移动、攻击、换位、炮击、对决
- `switchTurn()`: 切换回合
- `checkGameOver()`: 检查游戏结束条件（胜利、困毙）
- `checkStalemate()`: 检测困毙

### 4.5 特殊规则处理
- 护卫判定：`isGuard(satellite)`
- 攻击护卫验证：`canAttackGuard(attacker, defender)`
- 炮击条件验证：`isCannonReady(satellite)`

## 5. 规则实现重点
- 卫星两面移动规则（曜面横竖、弈面斜线）
- 将星九宫格换位规则
- 护卫反色攻击规则
- 炮击隔山打牛规则
- 将星对决同线无阻挡规则
- 困毙检测

## 6. 测试与验证
- 验证初始布局正确性
- 测试各种移动规则
- 测试攻击和护卫规则
- 测试炮击和对决规则
- 测试困毙判定
- 测试胜利条件

## 7. 响应式设计
- Canvas自适应窗口大小
- 移动端触摸支持

## 技术栈
- 纯HTML5 Canvas
- 原生JavaScript
- 内联CSS

## 实现步骤
1. 创建HTML结构和CSS样式
2. 实现数据结构和初始化函数
3. 实现棋盘绘制功能
4. 实现点击事件处理
5. 实现移动规则验证
6. 实现攻击和特殊规则
7. 实现游戏流程控制
8. 测试所有规则和边界情况
9. 优化响应式设计

严格遵循规则文档，确保所有规则精确实现，包括初始布局、移动规则、攻击规则、特殊规则和胜利条件。