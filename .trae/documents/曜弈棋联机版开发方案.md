# 曜弈棋联机版开发方案

## 1. 技术栈
- **前端**：HTML5 Canvas + JavaScript
- **后端**：Supabase (PostgreSQL + Auth)
- **通信**：Supabase Realtime (WebSocket)

## 2. 数据库设计

### 2.1 用户表 (`users`)
- `id` (UUID, 主键)
- `username` (VARCHAR, 唯一)
- `password_hash` (VARCHAR)
- `created_at` (TIMESTAMP)

### 2.2 游戏表 (`games`)
- `id` (UUID, 主键)
- `creator_id` (UUID, 外键)
- `invited_id` (UUID, 外键)
- `status` (VARCHAR: 'pending', 'active', 'completed')
- `red_player_id` (UUID)
- `blue_player_id` (UUID)
- `winner_id` (UUID, 可为空)
- `created_at` (TIMESTAMP)
- `updated_at` (TIMESTAMP)

### 2.3 游戏状态表 (`game_states`)
- `id` (UUID, 主键)
- `game_id` (UUID, 外键)
- `board_state` (JSONB)
- `current_turn` (VARCHAR: 'red', 'blue')
- `move_count` (INTEGER)
- `created_at` (TIMESTAMP)

## 3. 前端修改

### 3.1 认证系统
- 登录/注册界面
- 退出登录功能
- 用户状态管理

### 3.2 游戏大厅
- 显示在线玩家
- 邀请玩家功能
- 游戏列表

### 3.3 游戏界面
- 实时同步棋盘状态
- 显示对手信息
- 游戏控制

### 3.4 通信机制
- 使用Supabase Realtime监听游戏状态变化
- 实时更新棋盘
- 处理玩家操作

## 4. 后端API

### 4.1 认证API
- 用户注册
- 用户登录
- 用户登出
- 获取当前用户

### 4.2 游戏API
- 创建游戏
- 邀请玩家
- 接受邀请
- 获取游戏列表
- 获取游戏状态
- 更新游戏状态
- 结束游戏

## 5. 实现步骤

1. **设置Supabase项目**
2. **创建数据库表结构**
3. **配置认证系统**
4. **实现前端认证界面**
5. **实现游戏大厅**
6. **实现实时游戏同步**
7. **测试联机功能**

## 6. 关键功能

- **邀请机制**：创建游戏后生成邀请码，发送给好友
- **实时同步**：使用Supabase Realtime确保双方棋盘状态一致
- **状态管理**：跟踪游戏状态和玩家操作
- **错误处理**：处理网络延迟和连接问题

## 7. 安全考虑

- **密码加密**：使用Supabase Auth内置的密码加密
- **权限控制**：确保用户只能访问自己的游戏数据
- **输入验证**：防止恶意操作

## 8. 部署

- **前端**：部署到静态网站托管服务
- **后端**：使用Supabase云服务

此方案将实现一个基于Supabase的曜弈棋联机版，支持邀请好友对战，实时同步游戏状态，提供简单的登录注册系统。